---
title: 09-HTTPS
date: 2018-03-14 10:41:24
tags:
  - 网络
  - 笔记
---
<img src="/images/index/09.jpg" />
<!--more-->

# 吐槽
自2017年12月被放出来实习，至今也快有三个月了，有时候我在思考，自己到底在干什么，自己到底想干什么。我没有得出一个结论，我想大部分刚出社会的小baby们应该是都同样的想法。前端开发工程师，一个熟悉又陌生的名词。熟悉，是因为我正在从事相关的工作；陌生，是因为前端这个大坑“永无止境”。学习总是能让人豁然开朗，但是鲁迅说过：“学习不复习，知识记不住，知识记不住，等于没学习。”回头看看自己写的博客，感受颇多。我总是暗示自己得做学习总结，但总是三天打鱼两天晒网...地计划，em...  
工作使人增长经验，但似乎也仅限于此，许多的技术知识没法在工作中遇到，导致日积月累的记忆断层。果然，人就是人，不是电脑啊~~~  

# HTTP
HTTP是什么？这个似乎不需要多说，它就是一个传输协议，位于应用层，一般用在web上。比如：浏览器给服务器发送信息，服务器回传响应，这个过程就需要用到HTTP和TCP/IP协议。  
这个协议看似很OK，但其实隐藏了很多安全问题：

1. 通信使用的是明文，即内容是对外公开的，谁截到请求，谁就能看到请求的内容。
2. 通信时不验证身份，顾名思义，可能导致中间人攻击。
3. 无法验证报文完整性，即我寄给你一个包裹，但你拿到的包裹可能是被快递小哥哥掉包的包裹

总体感觉就是“我在外面裸奔，裸奔的我，弱弱的我，我能被任何人按在地上摩擦”。

# HTTPS
基于HTTP的弱点，广大人民群众想出了一个好方案来使HTTP安全化，后人称之为HTTPS。  
HTTPS = HTTP + 加密 + 认证 + 完整性保护 = HTTP + SSL/TLS  

### 加密
1. 共享密钥加密：客户端和服务器用同一个密钥加密和解密信息，但这有一个大问题：如何把这个密钥传给没有密钥的一方？要是被中间人截取了，那这个加密就形同虚设了。
2. 公钥私钥加密：即两把密钥，公钥发给你(用于加密)，私钥留自己(用于解密)。公钥随便给，反正解密的权利在我手上，这样就解决了中间人问题，反正拿了公钥也解密不了信息。
3. HTTPS的加密：因为公钥私钥的效率差，所以HTTPS采用了上面两者结合的方式。我用你发给我的公钥加密共享密钥 -> 你用你的私钥解析拿到共享密钥 -> 然后你处理了一下共享密钥 -> 你用我给你的公钥加密共享密钥 -> 我用我的私钥解析拿到共享密钥 -> 我俩愉快的用共享密钥进行加密解密通信。

### 证书
通过加密，安全问题就解决了吗？NONONO！这里还存在一个严重问题：你怎么知道我发给你的公钥是我的公钥呢？会不会是被别人截取后替换的公钥呢？  
这个问题交给证书吧，它可以保证公钥的合法性。（然而还是不能完全保证）  
证书类似公钥的身份证，由可信任的第三方公司（认证公司）颁发，使用证书的流程如图：
![数字证书](/images/数字证书.jpg)

### 完整性保护
HTTPS情况下，应用层发送数据时会附加一种叫做MAC(Message Authentication Code)的报文摘要，可以查知报文是否被篡改，从而保证了报文完整性。

## HTTPS通信流程
![HTPPS流程](/images/HTTPS流程.jpg)
1. 客户端表示要开始SSL通信了，报文中包含指定的SSL版本和加密组件列表
2. 服务器表示OK，返回SSL版本和加密组件
3. 服务器发送公钥证书
4. 服务器通知客户端SSL第一次握手结束
5. 客户端生成pre-master secret(一串随机数)，利用取出的公钥加密后发送给服务端
6. 客户端提示服务端在此之后的通信采用pre-master secret密钥加密
7. 客户端发送包含连接至今全部报文的整体校验值，如果服务器解密成功，则握手成功
8. 行为和6同理
9. 行为和7同理
10. SSL建立完成，开始进行HTTP请求
11. HTTP响应
12. 客户端断开连接